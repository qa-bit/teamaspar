{% trans_default_domain 'riders' %}

{% set r = rider %}

{% macro list_isset(locale, r, field) %}
    {% set f = (locale == 'es' ? field : (field ~ 'EN')) %}

    {% if attribute(r, f) %}
        <li>
            <span class="title">{{ field | trans }}:</span>
            <span>{{ attribute(r, field) }}</span>
        </li>
    {% endif %}
{% endmacro %}

{% import _self as forms %}

{% extends "MotogpBundle:Default:base.html.twig" %}
{% block body %}
    {{ parent() }}

    {% if rider.medias is not null and rider.medias | length %}
        {% include "MotogpBundle:Default:Blocks/top-slider.html.twig" with {'gallery' : rider } %}
    {% endif %}

    <div class="smoke-background">
        <div class="white-background">
            <div class="w100 rider-description">
                <div id="{{ r.name | lower }}-{{ r.surname | lower }}">
                    <div class="row info w100 relative" style="height:30em">
                        <div class="w100" style="min-height:30em;">
                            <div class="col-nopad bg-w100 col-xs-12 col-md-5" style="position:absolute;height:100%;background : url('{% path r.featuredMedia, 'big' %}')">

                            </div>

                            <div class="col-nopad col-xs-12 col-md-7 col-md-offset-5 rider-name">
                                <h3><span class="right-arrow">&#9654;&nbsp;</span><b>{{ r.name }} {{ r.surname }} #{{ r.number }}</b></h3>
                                <ul class="rider-info">
                                    <li>
                                        <span class="title">{{ 'birthDate' | trans }}:</span>
                                        <span>{{ r.birthDate | date('d/m/Y') }} - {{ r.birthPlace }} -  {{  r.country }} {{ 'age' | trans }}: {{ r.getAge() }} </span>
                                    </li>
                                    {{ forms.list_isset(locale, r, 'firstRace') }}
                                    {{ forms.list_isset(locale, r, 'firstGrandPrix') }}
                                    {{ forms.list_isset(locale, r, 'firstVictory') }}
                                    {{ forms.list_isset(locale, r, 'lastVictory') }}
                                    {{ forms.list_isset(locale, r, 'firstPole') }}
                                    {{ forms.list_isset(locale, r, 'firstFastLap') }}
                                    {{ forms.list_isset(locale, r, 'firstPodium') }}
                                    {{ forms.list_isset(locale, r, 'victorys') }}
                                    {{ forms.list_isset(locale, r, 'podiums') }}
                                    {{ forms.list_isset(locale, r, 'poles') }}
                                    {{ forms.list_isset(locale, r, 'firstRace') }}
                                    {{ forms.list_isset(locale, r, 'fastLaps') }}
                                    {{ forms.list_isset(locale, r, 'bestGeneralResult') }}
                                    {{ forms.list_isset(locale, r, 'gpss') }}
                                </ul>
                            </div>

                        </div>
                    </div>

                    {% if r.records | length %}
                        <div class="row track-records">
                            <h3><span class="right-arrow">&#9654;&nbsp;</span><b>{{ 'trackRecords' | trans }}</b></h3>

                            {%  for key, record in r.getGroupedRecords() %}
                                {% if loop.index == 1 or (loop.index % 10  == 0)%}
                                    <div class="col-xs-12 col-md-6">
                                    <ul class="rider-records">
                                {% endif %}
                                <li><span class="title">{{ key }}:</span>
                                    {% for ri in record %}
                                        {{ locale == 'es' ? ri.description : ri.descriptionEN }}<br>
                                    {% endfor %}
                                </li>
                                {% if (loop.index % 10  == 9) %}
                                    </ul></div>
                                {% endif %}
                            {%  endfor %}

                        </div>
                    {% endif %}
                </div>

                {% if r.description or r.descriptionEN %}
                    <div class="row info rider-biografy">
                        <h3><span class="right-arrow">&#9654;&nbsp;</span><b>{{ 'biografy' | trans }}</b></h3>
                        <div>{{ locale == 'es' ? (r.description | raw) : (r.descriptionEN | raw )}}</div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    </div
    {% set g = [] %}
    {% for gl in galleries %}
        {% for m in gl.medias %}
            {% if m.rider is not null and m.rider.id == r.id %}
                {% set g = g | merge([m]) %}
            {% endif %}
        {% endfor %}
    {% endfor %}

    {% if g | length %}
        {% include 'MotogpBundle:Default:Riders/rider-gallery.html.twig' with {'gallery' : g} %}
    {% endif %}

    {% include 'MotogpBundle:Default:footer.html.twig' %}
{% endblock %}